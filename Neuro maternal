<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NeuroRiesgo — Calculadora neonatal</title>

<!-- iOS home-screen meta -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="NeuroRiesgo">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<!-- Apple touch icon (SVG embebido como data URL) -->
<link rel="apple-touch-icon" href="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 64 64'>
  <rect rx='10' width='64' height='64' fill='%231e90ff'/>
  <g transform='translate(8,8)' fill='%23fff'>
    <path d='M20 2c-4 0-7 3-7 7 0 1 .2 2 .6 2.8C7.8 14 2 20.4 2 28c0 7 5.8 13 13 13h18c7.2 0 13-6 13-13 0-7.5-5.8-14-11.6-16.2.4-.8.6-1.8.6-2.8 0-4-3-7-7-7-2.6 0-4.9 1.4-6.1 3.5C24.9 3.4 22.6 2 20 2z'/>
    <circle cx='9' cy='18' r='3' fill='%231e90ff'/>
  </g>
</svg>">

<style>
:root{--bg:#f5f8fd;--card:#fff;--muted:#6b7280;--accent:#2563eb;--good:#16a34a;--warn:#f59e0b;--danger:#dc2626}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#0f172a}
.container{max-width:820px;margin:18px auto;padding:14px}
.header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,#2b6de6,#58a2ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
h1{font-size:18px;margin:0}
.card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(15,23,42,0.06)}
.row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
.col{flex:1;min-width:160px}
label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
select,input[type=number],textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6edf3;background:#fff;font-size:15px}
fieldset{border:1px dashed #e6eef8;padding:12px;border-radius:10px;margin-bottom:12px}
legend{font-weight:600}
.checks{display:flex;flex-wrap:wrap;gap:8px}
.checks label{background:#f8fafc;padding:8px 10px;border-radius:8px;border:1px solid #eef4fb;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:8px}
.actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;border:0;font-weight:600;cursor:pointer}
button.secondary{background:#fff;color:var(--accent);border:1px solid #dbeafe}
.result{margin-top:12px;padding:12px;border-radius:10px;background:#fbfdff;border:1px solid #eef6ff}
.score{font-weight:700;font-size:18px}
.note{font-size:13px;color:var(--muted);margin-top:8px}
@media(max-width:420px){h1{font-size:16px}}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">NR</div>
      <h1>NeuroRiesgo — Calculadora de riesgo neonatal</h1>
    </div>

    <div class="card">
      <form id="form">
        <fieldset>
          <legend>Diagnóstico y severidad</legend>
          <div class="row">
            <div class="col">
              <label>Trastornos maternos</label>
              <div class="checks" id="disorders">
                <label><input type="checkbox" value="depression"> Depresión</label>
                <label><input type="checkbox" value="anxiety"> Ansiedad</label>
                <label><input type="checkbox" value="stress"> Estrés</label>
                <label><input type="checkbox" value="other"> Otro</label>
              </div>
            </div>
            <div class="col">
              <label for="severity">Severidad</label>
              <select id="severity">
                <option value="none">Ninguna</option>
                <option value="mild">Leve</option>
                <option value="moderate" selected>Moderada</option>
                <option value="severe">Severa</option>
              </select>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Momento y duración</legend>
          <div class="row">
            <div class="col">
              <label>Momento</label>
              <div class="checks">
                <label><input type="checkbox" value="prenatal" id="t_pren"> Prenatal</label>
                <label><input type="checkbox" value="postnatal" id="t_post"> Postnatal</label>
              </div>
            </div>
            <div class="col">
              <label for="chronicity">Cronicidad</label>
              <select id="chronicity">
                <option value="episodic">Episódica</option>
                <option value="intermittent">Intermitente</option>
                <option value="persistent" selected>Persistente</option>
              </select>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Moderadores y neonatales</legend>
          <div class="row">
            <div class="col">
              <label for="sensitivity">Sensibilidad maternal</label>
              <select id="sensitivity">
                <option value="good">Buena</option>
                <option value="fair">Aceptable</option>
                <option value="poor" selected>Pobre</option>
              </select>
            </div>
            <div class="col">
              <label for="socioeconomic">Nivel socioeconómico</label>
              <select id="socioeconomic">
                <option value="high">Alto</option>
                <option value="mid">Medio</option>
                <option value="low" selected>Bajo</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label for="maternalAge">Edad materna</label>
              <input type="number" id="maternalAge" min="12" max="60" value="28">
            </div>
            <div class="col">
              <label>Factores neonatales</label>
              <div class="checks">
                <label><input type="checkbox" id="preterm"> Pretérmino</label>
                <label><input type="checkbox" id="lowBW"> Bajo peso al nacer</label>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="actions">
          <button type="button" id="calc">Calcular riesgo</button>
          <button type="button" class="secondary" id="reset">Restablecer</button>
          <div style="flex:1"></div>
        </div>

        <div id="out" class="result" style="display:none"></div>
        <p class="note">Este estimador ofrece una guía basada en evidencia resumida; no sustituye la valoración clínica.</p>
      </form>
    </div>
  </div>

<script>
(function(){
  // Utilidades
  function q(sel, root) { return (root || document).querySelector(sel); }
  function qa(sel, root) { return Array.from((root || document).querySelectorAll(sel)); }

  // Recoger datos del formulario
  function gather() {
    const disorders = qa('#disorders input[type=checkbox]').filter(i=>i.checked).map(i=>i.value);
    const severity = q('#severity').value;
    const timing = [];
    if (q('#t_pren').checked) timing.push('prenatal');
    if (q('#t_post').checked) timing.push('postnatal');
    const chronicity = q('#chronicity').value;
    const sensitivity = q('#sensitivity').value;
    const socioeconomic = q('#socioeconomic').value;
    const maternalAge = Number(q('#maternalAge').value) || null;
    const preterm = q('#preterm').checked;
    const lowBW = q('#lowBW').checked;
    return { mentalDisorders: disorders, severity, timing, chronicity, sensitivity, socioeconomic, maternalAge, preterm, lowBirthWeight: lowBW };
  }

  // Algoritmo de puntuación (heurístico, basado en evidencia resumida)
  function computeRisk(data) {
    let score = 0;
    const condW = { depression:3, anxiety:2.5, stress:1.5, other:1 };
    (data.mentalDisorders || []).forEach(c => { score += (condW[c]||0); });

    const sev = { none:0, mild:1, moderate:2, severe:3 };
    score += (sev[data.severity]||0);

    if ((data.timing||[]).includes('prenatal')) score += 2.2; // prenatal tiene peso alto en muchos estudios
    if ((data.timing||[]).includes('postnatal')) score += 1.2;

    if (data.chronicity === 'persistent') score += 2;
    else if (data.chronicity === 'intermittent') score += 1;

    if (data.sensitivity === 'poor') score += 2;
    else if (data.sensitivity === 'fair') score += 1;

    if (data.socioeconomic === 'low') score += 1.5;
    else if (data.socioeconomic === 'mid') score += 0.6;

    // Neonatal factors
    if (data.preterm) score += 2;
    if (data.lowBirthWeight) score += 1.5;

    // Edad materna atípica (muy joven o mayor) añade leve riesgo
    if (data.maternalAge && (data.maternalAge < 18 || data.maternalAge > 40)) score += 0.8;

    // Normalizar puntuación a 0-20 para interpretación
    if (score < 0) score = 0;
    if (score > 20) score = 20;
    return Math.round(score * 10) / 10; // 1 decimal
  }

  function categorize(score) {
    // Umbrales heurísticos
    if (score < 5) return {cat:'Bajo', color:'#16a34a', advice:'Seguimiento habitual.'};
    if (score < 11) return {cat:'Medio', color:'#f59e0b', advice:'Vigilar y ofertar apoyo psicosocial/seguimiento.'};
    return {cat:'Alto', color:'#dc2626', advice:'Derivar a equipo perinatal y seguimiento temprano del desarrollo.'};
  }

  // Mostrar resultado
  function showResult(score) {
    const out = q('#out');
    const r = categorize(score);
    out.style.display = 'block';
    out.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div>
          <div style="font-size:13px;color:var(--muted)">Puntuación</div>
          <div class="score">${score} / 20</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:13px;color:var(--muted)">Riesgo estimado</div>
          <div style="font-weight:700;color:${r.color};font-size:18px">${r.cat}</div>
        </div>
      </div>
      <div style="margin-top:10px;color:#0f172a">${r.advice}</div>
    `;
  }

  // Event handlers
  q('#calc').addEventListener('click', function(){
    const data = gather();
    const score = computeRisk(data);
    showResult(score);
  });

  q('#reset').addEventListener('click', function(){
    // Reset basic inputs
    qa('input[type=checkbox]').forEach(i=>i.checked=false);
    q('#severity').value='moderate';
    q('#chronicity').value='persistent';
    q('#sensitivity').value='poor';
    q('#socioeconomic').value='low';
    q('#maternalAge').value=28;
    q('#out').style.display='none';
  });

  // Small UX: tap labels toggle checkboxes (already behaves in browser)
})();
</script>
</body>
</html>
